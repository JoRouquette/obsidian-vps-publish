<nav class="explorer">
  <mat-form-field class="search" appearance="outline">
    <mat-icon matPrefix aria-hidden="true">search</mat-icon>
    <input
      matInput
      type="search"
      [value]="q()"
      (input)="onInputQuery($any($event.target).value)"
      placeholder="Rechercherâ€¦"
      aria-label="Rechercher dans le contenu"
      autocomplete="off"
      spellcheck="false"
    />
    @if (q()) {
    <button mat-icon-button matSuffix type="button" aria-label="Effacer" (click)="onInputQuery('')">
      <mat-icon>close</mat-icon>
    </button>
    }
  </mat-form-field>

  <mat-divider class="sep"></mat-divider>

  <div class="tree-wrap" #treeScroller (scroll)="syncX('tree')">
    <mat-tree
      class="tree"
      [dataSource]="rootChildren()"
      [childrenAccessor]="childrenOf"
      [trackBy]="trackByPath"
    >
      <!-- Dossier -->
      <mat-nested-tree-node
        *matTreeNodeDef="let n; when: isFolder"
        #node="matNestedTreeNode"
        class="node folder"
        [attr.aria-expanded]="node.isExpanded"
        matTreeNodePadding
        [matTreeNodePaddingIndent]="16"
      >
        <button
          class="node-header"
          type="button"
          matTreeNodeToggle
          aria-label="Ouvrir/fermer le dossier"
        >
          <mat-icon class="ico folder-ico" aria-hidden="true">folder</mat-icon>
          <span class="label">{{ n.label || n.name || 'root' }}</span>
          <mat-icon class="chev" aria-hidden="true">expand_more</mat-icon>
        </button>

        <div class="children" [class.open]="node.isExpanded" [attr.aria-hidden]="!node.isExpanded">
          <div class="children-inner">
            <ng-container matTreeNodeOutlet></ng-container>
          </div>
        </div>
      </mat-nested-tree-node>

      <!-- Fichier -->
      <mat-tree-node
        *matTreeNodeDef="let n; when: isFile"
        class="node file"
        matTreeNodePadding
        [matTreeNodePaddingIndent]="16"
      >
        <a class="file-link" [routerLink]="[`/${n.path}`]" aria-label="Ouvrir le fichier">
          <mat-icon class="ico file-ico" aria-hidden="true">description</mat-icon>
          <span class="label">{{ n.label }}</span>
        </a>
      </mat-tree-node>
    </mat-tree>
  </div>

  <div class="hscroll" #hScroller (scroll)="syncX('h')">
    <div class="phantom" [style.width.px]="treeScrollWidth"></div>
  </div>
</nav>
