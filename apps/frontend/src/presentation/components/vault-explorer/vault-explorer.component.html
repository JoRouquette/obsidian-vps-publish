<nav class="explorer">
  <mat-form-field class="search" appearance="outline">
    <mat-icon matPrefix aria-hidden="true">search</mat-icon>
    <input
      matInput
      type="search"
      [value]="q()"
      (input)="onInputQuery($any($event.target).value)"
      placeholder="Rechercherâ€¦"
      aria-label="Rechercher dans le contenu"
      autocomplete="off"
      spellcheck="false"
    />
    @if (q()) {
    <button mat-icon-button matSuffix type="button" aria-label="Effacer" (click)="onInputQuery('')">
      <mat-icon>close</mat-icon>
    </button>
    }
  </mat-form-field>

  <mat-divider class="sep"></mat-divider>

  @if (filteredTree()?.children?.length) {
  <mat-tree class="tree" [dataSource]="filteredTree()!.children!" [childrenAccessor]="childrenOf">
    <!-- Dossier -->
    <mat-nested-tree-node *matTreeNodeDef="let n; when: isFolder" class="node folder">
      <div
        class="node-header"
        matTreeNodeToggle
        tabindex="0"
        role="button"
        [attr.aria-expanded]="n.expanded ?? false"
        aria-label="Ouvrir le dossier"
      >
        <mat-icon class="ico folder-ico">folder</mat-icon>
        <span class="label">{{ n.label || n.name || 'root' }}</span>
        <mat-icon class="chev" aria-hidden="true">expand_more</mat-icon>
      </div>
      <div class="children" [class.collapsed]="!n.expanded">
        <ng-container matTreeNodeOutlet></ng-container>
      </div>
    </mat-nested-tree-node>

    <!-- Fichier -->
    <mat-tree-node *matTreeNodeDef="let n; when: isFile" class="node file">
      <a class="file-link" [routerLink]="['/', n.path]" aria-label="Ouvrir le fichier">
        <mat-icon class="ico file-ico">description</mat-icon>
        <span class="label">{{ n.label }}</span>
      </a>
    </mat-tree-node>
  </mat-tree>
  } @else {
  <p class="muted">Aucun contenu</p>
  }
</nav>
