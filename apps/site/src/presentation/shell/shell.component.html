<div class="grid" [class.sidebar-collapsed]="isSidebarCollapsed()">
  <!-- Hamburger menu button (mobile only) -->
  <button
    class="hamburger-menu mat-elevation-z2"
    mat-icon-button
    (click)="toggleMenu()"
    [attr.aria-label]="isMenuOpen() ? 'Fermer le menu' : 'Ouvrir le menu'"
    [attr.aria-expanded]="isMenuOpen()"
  >
    <mat-icon>{{ isMenuOpen() ? 'close' : 'menu' }}</mat-icon>
  </button>

  <!-- Desktop sidebar collapse toggle (left of logo) -->
  <button
    class="sidebar-toggle-desktop"
    mat-icon-button
    (click)="toggleSidebarCollapse()"
    [attr.aria-label]="isSidebarCollapsed() ? 'Ouvrir la sidebar' : 'Fermer la sidebar'"
    [attr.aria-expanded]="!isSidebarCollapsed()"
    matTooltip="{{ isSidebarCollapsed() ? 'Ouvrir la sidebar' : 'Fermer la sidebar' }}"
    matTooltipPosition="right"
  >
    <mat-icon>{{ isSidebarCollapsed() ? 'chevron_right' : 'chevron_left' }}</mat-icon>
  </button>

  <div class="Logo">
    <app-logo></app-logo>
  </div>

  <div class="TopBar mat-elevation-z2">
    @defer {
      <app-topbar
        [siteName]="siteName()"
        [crumbs]="crumbs()"
        [lastVisited]="lastNonSearchUrl"
        [isDark]="theme.isDark()"
        (toggleTheme)="theme.toggle()"
      >
      </app-topbar>
    } @placeholder {
      <div class="topbar-placeholder"></div>
    }
  </div>

  <!-- Backdrop overlay for mobile menu -->
  @if (isMenuOpen()) {
    <div class="menu-backdrop" (click)="closeMenu()"></div>
  }

  <!-- Vault explorer with desktop resize handle -->
  <div
    class="vault-explorer"
    [class.open]="isMenuOpen()"
    [style.width.px]="sidebarWidth()"
    data-testid="vault-explorer"
  >
    <!-- Resize handle (desktop only) -->
    <div
      class="resize-handle"
      (mousedown)="startResize($event)"
      (touchstart)="startResize($event)"
      role="separator"
      aria-orientation="vertical"
      aria-label="Redimensionner la sidebar"
      tabindex="0"
      (keydown)="handleResizeKeyboard($event)"
      data-testid="resize-handle"
    ></div>

    <!-- Mobile overlay header with theme toggle -->
    <div class="mobile-overlay-header">
      <button
        class="theme-toggle-mobile"
        mat-icon-button
        (click)="theme.toggle()"
        [attr.aria-label]="theme.isDark() ? 'Activer le thème clair' : 'Activer le thème sombre'"
        matTooltip="{{ theme.isDark() ? 'Thème clair' : 'Thème sombre' }}"
      >
        <mat-icon>{{ theme.isDark() ? 'light_mode' : 'dark_mode' }}</mat-icon>
      </button>
    </div>

    @if (vaultExplorerComponent(); as explorer) {
      <ng-container [ngComponentOutlet]="explorer"></ng-container>
    }
  </div>

  <div class="main">
    <div class="content-wrapper">
      <router-outlet></router-outlet>
    </div>

    <footer class="footer">
      <span class="icon">©</span> {{ currentYear }} {{ author() }}
      @if (repo() !== '') {
        <a class="repo-link" [href]="repo()" target="_blank" rel="noopener">
          <mat-icon aria-hidden="true">open_in_new</mat-icon>
          Code
        </a>
      }
      @if (reportIssues() !== '') {
        <a class="repo-link" [href]="reportIssues()" target="_blank" rel="noopener">
          <mat-icon aria-hidden="true">bug_report</mat-icon>
          Bugs
        </a>
      }
    </footer>
  </div>
</div>
